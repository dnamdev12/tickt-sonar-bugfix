{"ast":null,"code":"import _regeneratorRuntime from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _toConsumableArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/appinventiv/Documents/Project/tickt/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import close from\"../../../../assets/images/icon-close-1.png\";import addMedia from\"../../../../assets/images/add-image.png\";import{onFileUpload}from\"../../../../redux/auth/actions\";import{setShowToast,setLoading}from\"../../../../redux/common/actions\";import{withRouter}from\"react-router-dom\";//@ts-ignore\nimport FsLightbox from\"fslightbox-react\";import{lodgeDispute}from\"../../../../redux/jobs/actions\";import{JobLodgeReasons}from\"../../../../utils/common\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var imageFormats=[\"jpeg\",\"jpg\",\"png\"];var LodgeDispute=function LodgeDispute(props){var _props$item,_props$item2;var item=props===null||props===void 0?void 0:props.item;var jobId=props===null||props===void 0?void 0:(_props$item=props.item)===null||_props$item===void 0?void 0:_props$item.jobId;var jobName=props===null||props===void 0?void 0:(_props$item2=props.item)===null||_props$item2===void 0?void 0:_props$item2.jobName;var history=props===null||props===void 0?void 0:props.history;var _useState=useState({reason:0,detail:\"\",upload:[]}),_useState2=_slicedToArray(_useState,2),stateData=_useState2[0],setStateData=_useState2[1];var _useState3=useState({reason:\"\",detail:\"\",upload:\"\"}),_useState4=_slicedToArray(_useState3,2),errorData=_useState4[0],setErrorData=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),filesUrl=_useState6[0],setFilesUrl=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),localFiles=_useState8[0],setLocalFiles=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),update=_useState10[0],forceUpdate=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),toggler=_useState12[0],setToggler=_useState12[1];var _useState13=useState(1),_useState14=_slicedToArray(_useState13,2),selectedSlide=_useState14[0],setSelectSlide=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),isItemsLoad=_useState16[0],setLoadItems=_useState16[1];var reason=stateData.reason,detail=stateData.detail,upload=stateData.upload;var isValid=function isValid(_ref){var name=_ref.name,value=_ref.value,title=_ref.title;if(name===\"reason\"){return value===0?\"\".concat(title,\" is required.\"):\"\";}return!(value===null||value===void 0?void 0:value.length)?\"\".concat(title,\" is required.\"):\"\";};var checkErrors=function checkErrors(){var error_1=isValid({name:\"reason\",value:reason,title:\"Reason\"});var error_2=isValid({name:\"detail\",value:detail,title:\"Detail\"});var error_3=isValid({name:\"upload\",value:filesUrl,title:\"Media file\"});// if (!error_1?.length && !error_2?.length && !error_3?.length) {\nif(!(error_1===null||error_1===void 0?void 0:error_1.length)){return false;}return true;};useEffect(function(){setErrorData(function(prev){var _stateData$detail;return _objectSpread(_objectSpread({},prev),{},{detail:(stateData===null||stateData===void 0?void 0:(_stateData$detail=stateData.detail)===null||_stateData$detail===void 0?void 0:_stateData$detail.length)>1000?\"Maximum 1000 characters are allowed.\":\"\"});});},[stateData]);useEffect(function(){var _Object$values;var IsRenderValues=null;if((_Object$values=Object.values(isItemsLoad))===null||_Object$values===void 0?void 0:_Object$values.length){IsRenderValues=Array.isArray(Object.values(isItemsLoad))&&Object.values(isItemsLoad)[0]===true?Object.values(isItemsLoad)[0]:false;}if(IsRenderValues===false){setLoading(true);}if(IsRenderValues===true){setLoading(false);}},[isItemsLoad]);var removeFromItem=function removeFromItem(index){filesUrl.splice(index,1);setFilesUrl(filesUrl);Array.isArray(update)?forceUpdate([]):forceUpdate({});};var onFileChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _newFile$type,_newFile$type$split$;var formData,newFile,fileType,selectedFileSize,res,link,check_type;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:formData=new FormData();newFile=e.target.files[0];if(!((filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)===6)){_context.next=5;break;}setShowToast(true,\"Max files upload limit is 6\");return _context.abrupt(\"return\");case 5:fileType=newFile===null||newFile===void 0?void 0:(_newFile$type=newFile.type)===null||_newFile$type===void 0?void 0:(_newFile$type$split$=_newFile$type.split(\"/\")[1])===null||_newFile$type$split$===void 0?void 0:_newFile$type$split$.toLowerCase();selectedFileSize=(newFile===null||newFile===void 0?void 0:newFile.size)/1024/1024;// size in mib\nif(!(imageFormats.indexOf(fileType)<0||selectedFileSize>10)){_context.next=10;break;}setShowToast(true,\"The file must be in proper format or size\");return _context.abrupt(\"return\");case 10:if(!(imageFormats.includes(fileType)&&selectedFileSize>10)){_context.next=13;break;}// image validations\nsetShowToast(true,\"The image file size must be below 10 mb\");return _context.abrupt(\"return\");case 13:formData.append(\"file\",newFile);setLoadItems({});_context.next=17;return onFileUpload(formData);case 17:res=_context.sent;if(res.success){link=res.imgUrl;check_type=1;setFilesUrl(function(prev){return[].concat(_toConsumableArray(prev),[{mediaType:check_type,link:link}]);});setLoadItems(function(prev){return _defineProperty({},filesUrl.length-1,false);});setLocalFiles(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},filesUrl===null||filesUrl===void 0?void 0:filesUrl.length,URL.createObjectURL(newFile)));});}case 19:case\"end\":return _context.stop();}}},_callee);}));return function onFileChange(_x){return _ref2.apply(this,arguments);};}();var setItemToggle=function setItemToggle(index){setToggler(function(prev){return!prev;});setSelectSlide(index+1);};var renderbyFileFormat=function renderbyFileFormat(item,index){var split_item_format=item.split(\".\");var get_split_fromat=split_item_format[split_item_format.length-1];var split_item_name=item.split(\"/\");var get_split_name=split_item_name[split_item_name.length-1];var image_render=null;if(get_split_fromat){if(imageFormats.includes(get_split_fromat)){image_render=/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){setItemToggle(index);},title:get_split_name,src:item,alt:\"media\",onLoad:function onLoad(){setLoadItems(function(prev){return _defineProperty({},index,true);});}});}return/*#__PURE__*/_jsxs(\"figure\",{className:\"img_video\",children:[image_render,/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){removeFromItem(index);},src:close,alt:\"remove\",className:\"remove\"})]});}};var handleSubmit=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data={jobId:jobId,reason:reason};if(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length){data[\"photos\"]=filesUrl;}if(detail===null||detail===void 0?void 0:detail.length){data[\"details\"]=detail;}_context2.next=5;return lodgeDispute(data);case 5:response=_context2.sent;if(response===null||response===void 0?void 0:response.success){history.push(\"/lodge-success\");}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(){return _ref5.apply(this,arguments);};}();var renderTypes=function renderTypes(_ref6){var id=_ref6.id;return/*#__PURE__*/_jsxs(\"div\",{className:\"checkbox_wrap agree_check\",children:[/*#__PURE__*/_jsx(\"input\",{value:reason,onClick:function onClick(){setStateData(function(prev){return _objectSpread(_objectSpread({},prev),{},{reason:id});});},checked:reason===id,name:\"Reason\",className:\"filter-type filled-in\",type:\"checkbox\",id:\"reason\".concat(id)}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"reason\".concat(id),children:JobLodgeReasons(id,true)})]});};var renderFilteredItems=function renderFilteredItems(){var sources=[];var types=[];if(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length){filesUrl.forEach(function(item){if((item===null||item===void 0?void 0:item.mediaType)===1){sources.push(item.link);types.push(\"image\");}});}return{sources:sources,types:types};};var _renderFilteredItems=renderFilteredItems(),sources=_renderFilteredItems.sources,types=_renderFilteredItems.types;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex_row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relate\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){props.backTab(\"lodge\");},className:\"back\"}),/*#__PURE__*/_jsx(\"span\",{className:\"xs_sub_title\",children:jobName||\"\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"sub_title\",children:\"Lodge dispute\"}),/*#__PURE__*/_jsx(\"p\",{className:\"commn_para\",children:\"Enter reason text\"}),/*#__PURE__*/_jsx(FsLightbox,{toggler:toggler,slide:selectedSlide,sources:sources,types:types}),/*#__PURE__*/_jsxs(\"div\",{className:\"reason_wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw\",children:[renderTypes({id:1}),renderTypes({id:2})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw\",children:[renderTypes({id:3}),renderTypes({id:4})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"f_spacebw\",children:[renderTypes({id:5}),renderTypes({id:6})]}),/*#__PURE__*/_jsx(\"div\",{className:\"f_spacebw\",children:renderTypes({id:7})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex_col_sm_9\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form_field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form_label\",children:\"Details (optional)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text_field\",children:/*#__PURE__*/_jsx(\"textarea\",{value:detail,onChange:function onChange(e){setStateData(function(prev){return _objectSpread(_objectSpread({},prev),{},{detail:e.target.value.trimLeft()});});},placeholder:\"It\\u2019s really bad work, because...\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"error_msg\",children:errorData.detail})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex_col_sm_12\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"upload_img_video\",children:[(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)?filesUrl.map(function(item,index){return renderbyFileFormat(item.link,index);}):null,(filesUrl===null||filesUrl===void 0?void 0:filesUrl.length)<6?/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{className:\"upload_media\",htmlFor:\"upload_img_video\",children:/*#__PURE__*/_jsx(\"img\",{src:addMedia,alt:\"\"})}),/*#__PURE__*/_jsx(\"input\",{onChange:onFileChange,type:\"file\",accept:\"image/png,image/jpg,image/jpeg,.pdf, .doc, video/mp4, video/wmv, video/avi\",style:{display:\"none\"},id:\"upload_img_video\"})]}):null]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,className:\"fill_btn full_btn btn-effect \".concat(checkErrors()?\"disable_btn\":\"\"),children:\"Send\"})]})]});};export default withRouter(LodgeDispute);","map":{"version":3,"sources":["/home/appinventiv/Documents/Project/tickt/web/src/pages/builderJobDasboard/components/lodgeDispute/lodgeDispute.tsx"],"names":["React","useState","useEffect","close","addMedia","onFileUpload","setShowToast","setLoading","withRouter","FsLightbox","lodgeDispute","JobLodgeReasons","imageFormats","LodgeDispute","props","item","jobId","jobName","history","reason","detail","upload","stateData","setStateData","errorData","setErrorData","filesUrl","setFilesUrl","localFiles","setLocalFiles","update","forceUpdate","toggler","setToggler","selectedSlide","setSelectSlide","isItemsLoad","setLoadItems","isValid","name","value","title","length","checkErrors","error_1","error_2","error_3","prev","IsRenderValues","Object","values","Array","isArray","removeFromItem","index","splice","onFileChange","e","formData","FormData","newFile","target","files","fileType","type","split","toLowerCase","selectedFileSize","size","indexOf","includes","append","res","success","link","imgUrl","check_type","mediaType","URL","createObjectURL","setItemToggle","renderbyFileFormat","split_item_format","get_split_fromat","split_item_name","get_split_name","image_render","handleSubmit","data","response","push","renderTypes","id","renderFilteredItems","sources","types","forEach","backTab","trimLeft","map","display"],"mappings":"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","sourcesContent":["import React, { ReactElement, useState, useEffect } from \"react\";\nimport dummy from \"../../../../assets/images/u_placeholder.jpg\";\nimport approved from \"../../../../assets/images/approved.png\";\nimport waiting from \"../../../../assets/images/exclamation.png\";\nimport close from \"../../../../assets/images/icon-close-1.png\";\nimport addMedia from \"../../../../assets/images/add-image.png\";\nimport noDataFound from \"../../../../assets/images/no-search-data.png\";\n\nimport { onFileUpload } from \"../../../../redux/auth/actions\";\nimport { setShowToast, setLoading } from \"../../../../redux/common/actions\";\n\nimport { withRouter } from \"react-router-dom\";\n\n//@ts-ignore\nimport FsLightbox from \"fslightbox-react\";\n\nimport { lodgeDispute } from \"../../../../redux/jobs/actions\";\n\nimport { JobLodgeReasons } from \"../../../../utils/common\";\n\nconst imageFormats: Array<any> = [\"jpeg\", \"jpg\", \"png\"];\n\nconst LodgeDispute = (props: any) => {\n  let item = props?.item;\n  let jobId = props?.item?.jobId;\n  let jobName = props?.item?.jobName;\n  let history = props?.history;\n  const [stateData, setStateData] = useState({\n    reason: 0,\n    detail: \"\",\n    upload: [],\n  });\n  const [errorData, setErrorData] = useState({\n    reason: \"\",\n    detail: \"\",\n    upload: \"\",\n  });\n  const [filesUrl, setFilesUrl] = useState([] as any);\n  const [localFiles, setLocalFiles] = useState({});\n\n  const [update, forceUpdate] = useState({});\n  const [toggler, setToggler] = useState(false);\n  const [selectedSlide, setSelectSlide] = useState(1);\n\n  const [isItemsLoad, setLoadItems] = useState({});\n\n  const { reason, detail, upload } = stateData;\n\n  const isValid = ({ name, value, title }: any) => {\n    if (name === \"reason\") {\n      return value === 0 ? `${title} is required.` : \"\";\n    }\n    return !value?.length ? `${title} is required.` : \"\";\n  };\n\n  const checkErrors = () => {\n    let error_1 = isValid({ name: \"reason\", value: reason, title: \"Reason\" });\n    let error_2 = isValid({ name: \"detail\", value: detail, title: \"Detail\" });\n    let error_3 = isValid({\n      name: \"upload\",\n      value: filesUrl,\n      title: \"Media file\",\n    });\n\n    // if (!error_1?.length && !error_2?.length && !error_3?.length) {\n    if (!error_1?.length) {\n      return false;\n    }\n    return true;\n  };\n\n  useEffect(() => {\n    setErrorData((prev: any) => ({\n      ...prev,\n      detail:\n        stateData?.detail?.length > 1000\n          ? \"Maximum 1000 characters are allowed.\"\n          : \"\",\n    }));\n  }, [stateData]);\n\n  useEffect(() => {\n    let IsRenderValues = null;\n    if (Object.values(isItemsLoad)?.length) {\n      IsRenderValues =\n        Array.isArray(Object.values(isItemsLoad)) &&\n        Object.values(isItemsLoad)[0] === true\n          ? Object.values(isItemsLoad)[0]\n          : false;\n    }\n\n    if (IsRenderValues === false) {\n      setLoading(true);\n    }\n\n    if (IsRenderValues === true) {\n      setLoading(false);\n    }\n  }, [isItemsLoad]);\n\n  const removeFromItem = (index: any) => {\n    filesUrl.splice(index, 1);\n    setFilesUrl(filesUrl);\n    Array.isArray(update) ? forceUpdate([]) : forceUpdate({});\n  };\n\n  const onFileChange = async (e: any) => {\n    const formData = new FormData();\n    const newFile = e.target.files[0];\n\n    if (filesUrl?.length === 6) {\n      setShowToast(true, \"Max files upload limit is 6\");\n      return;\n    }\n\n    var fileType = newFile?.type?.split(\"/\")[1]?.toLowerCase();\n    var selectedFileSize = newFile?.size / 1024 / 1024; // size in mib\n\n    if (imageFormats.indexOf(fileType) < 0 || selectedFileSize > 10) {\n      setShowToast(true, \"The file must be in proper format or size\");\n      return;\n    }\n\n    if (imageFormats.includes(fileType) && selectedFileSize > 10) {\n      // image validations\n      setShowToast(true, \"The image file size must be below 10 mb\");\n      return;\n    }\n\n    formData.append(\"file\", newFile);\n    setLoadItems({});\n    const res = await onFileUpload(formData);\n    if (res.success) {\n      let link: string = res.imgUrl;\n      let check_type: any = 1;\n      setFilesUrl((prev: Array<any>) => [\n        ...prev,\n        {\n          mediaType: check_type,\n          link: link,\n        },\n      ]);\n      setLoadItems((prev: any) => ({\n        [filesUrl.length - 1]: false,\n      }));\n      setLocalFiles((prev: any) => ({\n        ...prev,\n        [filesUrl?.length]: URL.createObjectURL(newFile),\n      }));\n    }\n  };\n\n  const setItemToggle = (index: any) => {\n    setToggler((prev: boolean) => !prev);\n    setSelectSlide(index + 1);\n  };\n\n  const renderbyFileFormat = (item: any, index: any) => {\n    let split_item_format = item.split(\".\");\n    let get_split_fromat = split_item_format[split_item_format.length - 1];\n\n    let split_item_name = item.split(\"/\");\n    let get_split_name = split_item_name[split_item_name.length - 1];\n    let image_render: any = null;\n    if (get_split_fromat) {\n      if (imageFormats.includes(get_split_fromat)) {\n        image_render = (\n          <img\n            onClick={() => {\n              setItemToggle(index);\n            }}\n            title={get_split_name}\n            src={item}\n            alt=\"media\"\n            onLoad={() => {\n              setLoadItems((prev: any) => ({\n                [index]: true,\n              }));\n            }}\n          />\n        );\n      }\n      return (\n        <figure className=\"img_video\">\n          {image_render}\n          <img\n            onClick={() => {\n              removeFromItem(index);\n            }}\n            src={close}\n            alt=\"remove\"\n            className=\"remove\"\n          />\n          {/* <span style={{ fontSize: '10px' }}>{get_split_name}</span> */}\n        </figure>\n      );\n    }\n  };\n\n  const handleSubmit = async () => {\n    let data: any = {\n      jobId: jobId,\n      reason: reason,\n    };\n\n    if (filesUrl?.length) {\n      data[\"photos\"] = filesUrl;\n    }\n\n    if (detail?.length) {\n      data[\"details\"] = detail;\n    }\n\n    let response: any = await lodgeDispute(data);\n\n    if (response?.success) {\n      history.push(\"/lodge-success\");\n    }\n  };\n\n  const renderTypes = ({ id }: any) => {\n    return (\n      <div className=\"checkbox_wrap agree_check\">\n        <input\n          value={reason}\n          onClick={() => {\n            setStateData((prev: any) => ({ ...prev, reason: id }));\n          }}\n          checked={reason === id}\n          name=\"Reason\"\n          className=\"filter-type filled-in\"\n          type=\"checkbox\"\n          id={`reason${id}`}\n        />\n        <label htmlFor={`reason${id}`}>{JobLodgeReasons(id, true)}</label>\n      </div>\n    );\n  };\n\n  const renderFilteredItems = () => {\n    let sources: any = [];\n    let types: any = [];\n\n    if (filesUrl?.length) {\n      filesUrl.forEach((item: any) => {\n        if (item?.mediaType === 1) {\n          sources.push(item.link);\n          types.push(\"image\");\n        }\n      });\n    }\n\n    return { sources, types };\n  };\n\n  const { sources, types } = renderFilteredItems();\n\n  return (\n    <div className=\"flex_row\">\n      <div className=\"flex_col_sm_8\">\n        <div className=\"relate\">\n          <button\n            onClick={() => {\n              props.backTab(\"lodge\");\n            }}\n            className=\"back\"\n          ></button>\n          <span className=\"xs_sub_title\">{jobName || \"\"}</span>\n        </div>\n        <span className=\"sub_title\">Lodge dispute</span>\n        <p className=\"commn_para\">Enter reason text</p>\n\n        <FsLightbox\n          toggler={toggler}\n          slide={selectedSlide}\n          sources={sources}\n          types={types}\n        />\n\n        <div className=\"reason_wrap\">\n          <div className=\"f_spacebw\">\n            {renderTypes({ id: 1 })}\n            {renderTypes({ id: 2 })}\n          </div>\n\n          <div className=\"f_spacebw\">\n            {renderTypes({ id: 3 })}\n            {renderTypes({ id: 4 })}\n          </div>\n\n          <div className=\"f_spacebw\">\n            {renderTypes({ id: 5 })}\n            {renderTypes({ id: 6 })}\n          </div>\n\n          <div className=\"f_spacebw\">{renderTypes({ id: 7 })}</div>\n        </div>\n      </div>\n\n      <div className=\"flex_col_sm_9\">\n        <div className=\"form_field\">\n          <label className=\"form_label\">Details (optional)</label>\n          <div className=\"text_field\">\n            <textarea\n              value={detail}\n              onChange={(e: any) => {\n                setStateData((prev: any) => ({\n                  ...prev,\n                  detail: e.target.value.trimLeft(),\n                }));\n              }}\n              placeholder=\"Itâ€™s really bad work, because...\"\n            ></textarea>\n          </div>\n          <span className=\"error_msg\">{errorData.detail}</span>\n        </div>\n      </div>\n      <div className=\"flex_col_sm_12\">\n        <div className=\"upload_img_video\">\n          {filesUrl?.length\n            ? filesUrl.map((item: any, index: number) =>\n                renderbyFileFormat(item.link, index)\n              )\n            : null}\n\n          {filesUrl?.length < 6 ? (\n            <React.Fragment>\n              <label className=\"upload_media\" htmlFor=\"upload_img_video\">\n                <img src={addMedia} alt=\"\" />\n              </label>\n              <input\n                onChange={onFileChange}\n                type=\"file\"\n                accept=\"image/png,image/jpg,image/jpeg,.pdf, .doc, video/mp4, video/wmv, video/avi\"\n                style={{ display: \"none\" }}\n                id=\"upload_img_video\"\n              />\n            </React.Fragment>\n          ) : null}\n        </div>\n        <button\n          onClick={handleSubmit}\n          className={`fill_btn full_btn btn-effect ${\n            checkErrors() ? \"disable_btn\" : \"\"\n          }`}\n        >\n          {\"Send\"}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default withRouter(LodgeDispute);\n"]},"metadata":{},"sourceType":"module"}